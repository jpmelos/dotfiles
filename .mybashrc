# vim:ft=sh

PS1='\[\e[1;32m\][\u@\h \W]\$\[\e[0m\] '
EDITOR=/usr/bin/vim
export GREP_COLORS="fn=37"

alias ls='ls -F --color=never'
alias list='ls -FhAls --color=never | less -r'
alias cp='cp -i'
alias mv='mv -i'
alias cal='cal -3'
alias grep='grep --color=always --binary-files=without-match -n'
alias less='less -r'
alias p2l='mypdflatex'
alias flv2mp3='youtube-dl -t -x --audio-format mp3 --audio-quality 128k'
alias screen='screen -rd || screen'
alias tmux='tmux attach || tmux'
alias vim="vim -O"

function mypdflatex
{
    pdflatex $1
    pdflatex $1
    evince ${1%tex}pdf
}

dockps()  {
  docker ps ${@:2} | awk '
  NR==1{
    FIRSTLINEWIDTH=length($0)
    IDPOS=index($0,"CONTAINER ID");
    IMAGEPOS=index($0,"IMAGE");
    COMMANDPOS=index($0,"COMMAND");
    CREATEDPOS=index($0,"CREATED");
    STATUSPOS=index($0,"STATUS");
    PORTSPOS=index($0,"PORTS");
    NAMESPOS=index($0,"NAMES");
    UPDATECOL();
  }
  function UPDATECOL () {
    ID=substr($0,IDPOS,IMAGEPOS-IDPOS-1);
    IMAGE=substr($0,IMAGEPOS,COMMANDPOS-IMAGEPOS-1);
    COMMAND=substr($0,COMMANDPOS,CREATEDPOS-COMMANDPOS-1);
    CREATED=substr($0,CREATEDPOS,STATUSPOS-CREATEDPOS-1);
    STATUS=substr($0,STATUSPOS,PORTSPOS-STATUSPOS-1);
    PORTS=substr($0,PORTSPOS,NAMESPOS-PORTSPOS-1);
    NAMES=substr($0, NAMESPOS);
  }
  function PRINT () {
    print '"${1//|/ }"';
  }
  NR==2{
    NAMES=sprintf("%s%*s",NAMES,length($0)-FIRSTLINEWIDTH,"");
    PRINT();
  }
  NR>1{
    UPDATECOL();
    PRINT();
  }' | less -FSX;
}
dps() { dockps "ID|NAMES|IMAGE|STATUS|CREATED|COMMAND" $@; }
dpsa() { dps -a $@; }
dports() { dockps "NAMES|PORTS" $@; }

# Reduce images.
# Usage: redimg JPG ==> Reduce all JPG images (this is case-sensitive).
redimg() {
    for file in *.$1; do convert "$file" -resize 600 -quality 50 "$file"; composite -dissolve 30% -gravity southeast -quality 100 "$2" "$file" "$file"; done
}

localserver() {
    docker run --name localserver -v $PWD:/usr/share/nginx/html:ro -v $HOME/localserver.conf:/etc/nginx/conf.d/localserver.conf:ro --rm --privileged=true -p 80:80 nginx
}
